<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    document.addEventListener('DOMContentLoaded', () => {
        // Find all code blocks with language-mermaid class (Jekyll kramdown)
        const mermaidBlocks = document.querySelectorAll('pre > code.language-mermaid');

        mermaidBlocks.forEach(block => {
            // Create a div with class mermaid for the library to target
            const div = document.createElement('div');
            div.classList.add('mermaid');
            div.textContent = block.textContent;

            // Replace the entire pre/code structure with the mermaid div
            const pre = block.closest('pre');
            const container = pre.closest('div.highlighter-rouge, div.language-mermaid'); // Jekyll container

            if (container) {
                container.parentNode.replaceChild(div, container);
            } else {
                pre.parentNode.replaceChild(div, pre);
            }
        });

        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose'
        });
    });
</script>